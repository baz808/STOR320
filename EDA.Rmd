---
title: "EDA"
author: "Sarah Bazari"
date: "2025-07-15"
output: html_document
---

*** Questions 8 and 10 ***

```{r}
library(readr)
library(tidyverse)
data = read_csv("Police_Arrests_Clean.csv")
```

```{r}
# 10) Which zip code in Chapel Hill experiences the most arrests? And accordingly, what classifications of offenses are most common to each zip code?

# filters just for chapel hill
chapel_hill_arrests = data %>%
  filter(City == "CHAPEL HILL")
# count arrests per zipcode
zip_counts = chapel_hill_arrests %>%
  count(Zip, sort = TRUE)

zip_counts
```

```{r}
# count most common charges per zipcode
offense_by_zip = chapel_hill_arrests %>%
  count(Zip, Charge, sort = TRUE)

# see the top offenses per zip
offense_by_zip %>%
  group_by(Zip) %>%
  slice_max(n, n = 3) %>% # top 3 per zip
  arrange(Zip, desc(n))
```
```{r}
# visualiztion bar plot

ggplot(zip_counts, aes(reorder(as.character(Zip), -n), y = n)) +
  geom_col(fill = "#E63946", width = 0.7) +  # Nice deep red tone
  labs(
    title = "Number of Arrests by Zip Code in Chapel Hill",
    subtitle = "Zip codes with the highest arrest counts shown in descending order",
    x = "Zip Code",
    y = "Number of Arrests"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12, color = "gray40"),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 12),
    axis.text.y = element_text(size = 12),
    axis.title = element_text(face = "bold"),
    plot.margin = margin(10, 20, 10, 10)
  )
```

```{r}
# 8) How does the presence of drugs or alcohol at the time of arrest vary by gender, and which gender shows a higher proportion of substance-involved arrests?

substance_by_gender = data %>%
  filter(Gender %in% c("M", "F"),
         Drugs_Alcohol %in% c("Y", "N")) %>%
  count(Gender, Drugs_Alcohol) %>%
  group_by(Gender) %>%
  mutate(Proportion = n / sum(n)) %>%
  ungroup()

substance_by_gender
```

```{r}
# visualiztion 

ggplot(substance_by_gender, aes(x = Gender, y = Proportion, fill = Drugs_Alcohol)) +
  geom_col(position = "dodge") +
  scale_fill_manual(
    values = c("Y" = "#1b9e77", "N" = "#d95f02"),
    labels = c("Y" = "Yes", "N" = "No")
  ) +
  labs(
    title = "Proportion of Arrests Involving Drugs or Alcohol by Gender",
    subtitle = "Includes only arrests with known gender and substance info",
    x = "Gender",
    y = "Proportion of Arrests",
    fill = "Substance Present?"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12, color = "gray40"),
    axis.text.x = element_text(face = "bold"),
    legend.position = "top",
    legend.title = element_text(face = "bold")
  ) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))

```

```{r}
# most common charges for each weapon type

charges_by_weapon = data %>%
  filter(!is.na(Weapon)) %>%
  group_by(Weapon, Charge) %>%
  summarize(Count = n(), .groups = "drop") %>%
  arrange(Weapon, desc(Count))

head(charges_by_weapon, 10)
```

```{r}
# weapon presence by race and gender
weapon_by_race_gender = data %>%
  filter(!is.na(Weapon), Gender %in% c("M", "F"), Race !="U") %>%
  group_by(Weapon, Race, Gender) %>%
  summarise(Count = n(), .groups = "drop") %>%
  arrange(Weapon, desc(Count))

head(weapon_by_race_gender, 10)
```

```{r}
# visual 'weapon_by_race_gender'

library(stringr)

weapon_by_race_gender$Weapon <- str_wrap(weapon_by_race_gender$Weapon, width = 15)

ggplot(weapon_by_race_gender, aes(x = Race, y = Count, fill = Gender)) +
  geom_col(position = "dodge", width = 0.7) +
  facet_wrap(~ Weapon, scales = "free_y", ncol = 3) +
  scale_fill_manual(values = c("F" = "#f8766d", "M" = "#00bfc4")) +
  labs(
    title = "Weapons Involved in Arrests by Race and Gender",
    subtitle = "Grouped by weapon type and separated by gender",
    x = "Race",
    y = "Number of Arrests",
    fill = "Gender"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    strip.text = element_text(face = "bold", size = 9, angle = 0),
    strip.text.x = element_text(margin = margin(b = 5)),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )
```

```{r}
# visual for most common charges for the top 3 weapon types

library(ggplot2)

top_charges = data %>%
  filter(!is.na(Charge)) %>%
  count(Charge, sort = TRUE) %>%
  slice_max(n, n = 15)

ggplot(top_charges, aes(x = reorder(Charge, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(title = "Top 15 Charges in Chapel Hill", x = "Charge", y = "Number of Arrests") +
  theme_minimal()
```

```{r}
library(dplyr)
library(ggplot2)
library(stringr)

# fix name of one of the weapons
data <- data %>%
  mutate(Weapon = str_to_upper(Weapon)) %>%
  mutate(Weapon = ifelse(Weapon == "LETHAL CUTTING INSTRUMENT", "CUTTING INSTRUMENT", Weapon))

# top 3 weapons
top_weapons <- data %>%
  filter(!is.na(Weapon)) %>%
  count(Weapon, sort = TRUE) %>%
  slice_max(n, n = 3) %>%
  pull(Weapon)

# top 5 charges each weapon
top_charges <- data %>%
  filter(Weapon %in% top_weapons, !is.na(Charge)) %>%
  group_by(Weapon, Charge) %>%
  summarise(Count = n(), .groups = "drop") %>%
  group_by(Weapon) %>%
  slice_max(Count, n = 5) %>%
  ungroup()

top_charges$Charge <- str_wrap(top_charges$Charge, width = 20)

ggplot(top_charges, aes(x = Charge, y = Count)) +
  geom_col(fill = "steelblue") +
  facet_wrap(~ Weapon, scales = "free") +
  labs(
    title = "Top 5 Charges for the 3 Most Common Weapon Types",
    x = "Charge", y = "Number of Arrests"
  ) +
  coord_cartesian(clip = "off") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 55, hjust = 1, size = 5),
        strip.text = element_text(size = 10)
)
```




